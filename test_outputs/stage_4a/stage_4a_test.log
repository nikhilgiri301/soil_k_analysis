2025-07-09 06:02:26,118 - stage_4a_test - INFO - Starting Stage 4A test for paper: Agricultural Pollution Field Burning.json
2025-07-09 06:02:26,119 - stage_4a_test - INFO - Loading Stage 3B dependency (validated synthesis)...
2025-07-09 06:02:26,126 - stage_4a_test - ERROR - Stage 4A test failed: Failed to fetch Stage 3B input - Stage 3B results not found. Only validated synthesis (Stage 3B) is accepted for client mapping.
Please run Stage 3B first:
  python test_stage_3b.py --paper Agricultural Pollution Field Burning.json --api-key YOUR_KEY
Traceback (most recent call last):
  File "/mnt/c/Users/Nikhil/Desktop/Potash-Papers/soil_k_analysis/test_stage_4a.py", line 65, in test_stage_4a
    raise ValueError(
ValueError: Failed to fetch Stage 3B input - Stage 3B results not found. Only validated synthesis (Stage 3B) is accepted for client mapping.
Please run Stage 3B first:
  python test_stage_3b.py --paper Agricultural Pollution Field Burning.json --api-key YOUR_KEY
2025-07-09 06:02:26,146 - stage_4a_test - INFO - Saved stage output to: 8_stage_outputs/stage_4a/Agricultural Pollution Field Burning_4a_20250709_060226.json
2025-07-09 06:02:37,757 - stage_4a_test - INFO - Starting Stage 4A test for paper: Balance of potassium in two long-term field experiments with different fertilization treatments.json
2025-07-09 06:02:37,758 - stage_4a_test - INFO - Loading Stage 3B dependency (validated synthesis)...
2025-07-09 06:02:37,785 - stage_4a_test - INFO - Loading client architecture...
2025-07-09 06:02:37,802 - stage_4a_test - INFO - Initializing Gemini client and components...
2025-07-09 06:02:37,815 - stage_4a_test - INFO - Processing Stage 4A client mapping...
2025-07-09 06:02:37,829 - stage_4a_test - INFO - Saved stage output to: 8_stage_outputs/stage_4a/Balance of potassium in two long-term field experiments with different fertilization treatments_4a_20250709_060237.json
2025-07-09 06:02:37,834 - stage_4a_test - WARNING - Validation issues found: ["Stage returned error: 'stage_3b_results'"]
2025-07-09 06:03:14,241 - stage_4a_test - INFO - Starting Stage 4A test for paper: Balance of potassium in two long-term field experiments with different fertilization treatments.json
2025-07-09 06:03:14,242 - stage_4a_test - INFO - Loading Stage 3B dependency (validated synthesis)...
2025-07-09 06:03:14,270 - stage_4a_test - INFO - Loading client architecture...
2025-07-09 06:03:14,284 - stage_4a_test - INFO - Initializing Gemini client and components...
2025-07-09 06:03:14,297 - stage_4a_test - INFO - Processing Stage 4A client mapping...
2025-07-09 06:03:14,302 - stage_4a_test - ERROR - Stage 4A test failed: name 'stage_3a_result' is not defined
Traceback (most recent call last):
  File "/mnt/c/Users/Nikhil/Desktop/Potash-Papers/soil_k_analysis/6_synthesis_engine/stage_4_processors/client_mapper.py", line 40, in map_to_client
    formatted_prompt = self.prompt_template.format(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyError: '\n  "paper_identification"'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/mnt/c/Users/Nikhil/Desktop/Potash-Papers/soil_k_analysis/test_stage_4a.py", line 126, in test_stage_4a
    results = await mapper.map_to_client(synthesis_input, client_architecture)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/c/Users/Nikhil/Desktop/Potash-Papers/soil_k_analysis/6_synthesis_engine/stage_4_processors/client_mapper.py", line 66, in map_to_client
    "paper_id": stage_3a_result.get('paper_id', 'unknown'),
                ^^^^^^^^^^^^^^^
NameError: name 'stage_3a_result' is not defined. Did you mean: 'stage_3b_result'?
2025-07-09 06:03:14,326 - stage_4a_test - INFO - Saved stage output to: 8_stage_outputs/stage_4a/Balance of potassium in two long-term field experiments with different fertilization treatments_4a_20250709_060314.json
2025-07-09 06:03:50,269 - stage_4a_test - INFO - Starting Stage 4A test for paper: Balance of potassium in two long-term field experiments with different fertilization treatments.json
2025-07-09 06:03:50,270 - stage_4a_test - INFO - Loading Stage 3B dependency (validated synthesis)...
2025-07-09 06:03:50,298 - stage_4a_test - INFO - Loading client architecture...
2025-07-09 06:03:50,314 - stage_4a_test - INFO - Initializing Gemini client and components...
2025-07-09 06:03:50,327 - stage_4a_test - INFO - Processing Stage 4A client mapping...
2025-07-09 06:04:07,243 - stage_4a_test - INFO - Saved stage output to: 8_stage_outputs/stage_4a/Balance of potassium in two long-term field experiments with different fertilization treatments_4a_20250709_060407.json
2025-07-09 06:04:07,249 - stage_4a_test - WARNING - Validation issues found: ['Stage returned error: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"\ndomain: "googleapis.com"\nmetadata {\n  key: "service"\n  value: "generativelanguage.googleapis.com"\n}\n, locale: "en-US"\nmessage: "API key not valid. Please pass a valid API key."\n]']
2025-07-09 06:05:46,759 - stage_4a_test - INFO - Starting Stage 4A test for paper: Balance of potassium in two long-term field experiments with different fertilization treatments.json
2025-07-09 06:05:46,760 - stage_4a_test - INFO - Loading Stage 3B dependency (validated synthesis)...
2025-07-09 06:05:46,788 - stage_4a_test - INFO - Loading client architecture...
2025-07-09 06:05:46,804 - stage_4a_test - INFO - Initializing Gemini client and components...
2025-07-09 06:05:46,822 - stage_4a_test - INFO - Processing Stage 4A client mapping...
2025-07-09 06:06:34,926 - stage_4a_test - INFO - Caching successful results to isolated test...
2025-07-09 06:06:34,962 - stage_4a_test - INFO - Saved stage output to: 8_stage_outputs/stage_4a/Balance of potassium in two long-term field experiments with different fertilization treatments_4a_20250709_060634.json
2025-07-09 06:06:34,970 - stage_4a_test - WARNING - Validation issues found: ['Missing required field: mapped_parameters', 'Missing required field: client_questions_addressed']
2025-07-09 06:07:27,220 - stage_4a_test - INFO - Starting Stage 4A test for paper: Balance of potassium in two long-term field experiments with different fertilization treatments.json
2025-07-09 06:07:27,221 - stage_4a_test - INFO - Loading Stage 3B dependency (validated synthesis)...
2025-07-09 06:07:27,245 - stage_4a_test - INFO - Loading client architecture...
2025-07-09 06:07:27,261 - stage_4a_test - INFO - Initializing Gemini client and components...
2025-07-09 06:07:27,279 - stage_4a_test - INFO - Found cached results, loading...
2025-07-09 06:07:27,309 - stage_4a_test - INFO - Saved stage output to: 8_stage_outputs/stage_4a/Balance of potassium in two long-term field experiments with different fertilization treatments_4a_20250709_060727.json
2025-07-09 06:07:37,853 - stage_4a_test - INFO - Starting Stage 4A test for paper: Balance of potassium in two long-term field experiments with different fertilization treatments.json
2025-07-09 06:07:37,854 - stage_4a_test - INFO - Loading Stage 3B dependency (validated synthesis)...
2025-07-09 06:07:37,881 - stage_4a_test - INFO - Loading client architecture...
2025-07-09 06:07:37,899 - stage_4a_test - INFO - Initializing Gemini client and components...
2025-07-09 06:07:37,916 - stage_4a_test - INFO - Found cached results, loading...
2025-07-09 06:07:37,952 - stage_4a_test - INFO - Saved stage output to: 8_stage_outputs/stage_4a/Balance of potassium in two long-term field experiments with different fertilization treatments_4a_20250709_060737.json
2025-07-09 07:08:30,740 - stage_4a_test - INFO - Starting Stage 4A test for paper: Balance of potassium in two long-term field experiments with different fertilization treatments
2025-07-09 07:08:30,741 - stage_4a_test - INFO - Loading Stage 3B dependency (validated synthesis)...
2025-07-09 07:08:30,765 - stage_4a_test - INFO - Loading client architecture...
2025-07-09 07:08:30,781 - stage_4a_test - INFO - Initializing Gemini client and components...
2025-07-09 07:08:30,802 - stage_4a_test - INFO - Found cached results, loading...
2025-07-09 07:08:30,833 - stage_4a_test - INFO - Saved stage output to: 8_stage_outputs/stage_4a/Balance of potassium in two long-term field experiments with different fertilization treatments_4a_20250709_070830.json
2025-07-09 07:08:58,184 - stage_4a_test - INFO - Starting Stage 4A test for paper: Balance of potassium in two long-term field experiments with different fertilization treatments
2025-07-09 07:08:58,185 - stage_4a_test - INFO - Loading Stage 3B dependency (validated synthesis)...
2025-07-09 07:08:58,212 - stage_4a_test - INFO - Loading client architecture...
2025-07-09 07:08:58,228 - stage_4a_test - INFO - Initializing Gemini client and components...
2025-07-09 07:08:58,241 - stage_4a_test - INFO - Processing Stage 4A client mapping...
2025-07-09 07:09:49,587 - stage_4a_test - INFO - Saved stage output to: 8_stage_outputs/stage_4a/Balance of potassium in two long-term field experiments with different fertilization treatments_4a_20250709_070949.json
2025-07-09 08:33:22,739 - stage_4a_test - INFO - Starting Stage 4A test for paper: Balance of potassium in two long-term field experiments with different fertilization treatments
2025-07-09 08:33:22,740 - stage_4a_test - INFO - Loading Stage 3B dependency (validated synthesis)...
2025-07-09 08:33:22,779 - stage_4a_test - INFO - Loading client architecture...
2025-07-09 08:33:22,828 - stage_4a_test - INFO - Initializing Gemini client and components...
2025-07-09 08:33:22,863 - stage_4a_test - INFO - Found cached results, loading...
2025-07-09 08:33:22,918 - stage_4a_test - INFO - Saved stage output to: 8_stage_outputs/stage_4a/Balance of potassium in two long-term field experiments with different fertilization treatments_4a_20250709_083322.json
2025-07-09 08:33:33,362 - stage_4a_test - INFO - Starting Stage 4A test for paper: Balance of potassium in two long-term field experiments with different fertilization treatments
2025-07-09 08:33:33,363 - stage_4a_test - INFO - Loading Stage 3B dependency (validated synthesis)...
2025-07-09 08:33:33,390 - stage_4a_test - INFO - Loading client architecture...
2025-07-09 08:33:33,406 - stage_4a_test - INFO - Initializing Gemini client and components...
2025-07-09 08:33:33,423 - stage_4a_test - INFO - Found cached results, loading...
2025-07-09 08:33:33,455 - stage_4a_test - INFO - Saved stage output to: 8_stage_outputs/stage_4a/Balance of potassium in two long-term field experiments with different fertilization treatments_4a_20250709_083333.json
2025-07-09 08:33:40,581 - stage_4a_test - INFO - Starting Stage 4A test for paper: Balance of potassium in two long-term field experiments with different fertilization treatments
2025-07-09 08:33:40,582 - stage_4a_test - INFO - Loading Stage 3B dependency (validated synthesis)...
2025-07-09 08:33:40,607 - stage_4a_test - INFO - Loading client architecture...
2025-07-09 08:33:40,624 - stage_4a_test - INFO - Initializing Gemini client and components...
2025-07-09 08:33:40,638 - stage_4a_test - INFO - Processing Stage 4A client mapping...
2025-07-09 08:34:35,244 - stage_4a_test - INFO - Saved stage output to: 8_stage_outputs/stage_4a/Balance of potassium in two long-term field experiments with different fertilization treatments_4a_20250709_083435.json
2025-07-09 11:15:16,996 - stage_4a_test - INFO - Starting Stage 4A test for paper: Balance of potassium in two long-term field experiments with different fertilization treatments
2025-07-09 11:15:16,997 - stage_4a_test - INFO - Loading Stage 3B dependency (validated synthesis)...
2025-07-09 11:15:17,025 - stage_4a_test - INFO - Loading client architecture...
2025-07-09 11:15:17,042 - stage_4a_test - INFO - Initializing Gemini client and components...
2025-07-09 11:15:17,053 - stage_4a_test - INFO - Processing Stage 4A client mapping...
2025-07-09 11:16:08,908 - stage_4a_test - INFO - Saved stage output to: 8_stage_outputs/stage_4a/Balance of potassium in two long-term field experiments with different fertilization treatments_4a_20250709_111608.json
